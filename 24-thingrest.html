<!--
  Copyright 2016 ThingWorx

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="REST Thing">
    <div class="form-row">
        <label for="node-input-url"><i class="fa fa-globe"></i> <span data-i18n="thingrest.label.url"></span></label>
        <input type="text" id="node-input-url" placeholder="http://">
    </div>
    <div class="form-row">
        <label for="node-input-thingname"><i class="fa fa-globe"></i> <span>Thing Name</span></label>
        <input type="text" id="node-input-thingname" placeholder="ThingName">
    </div>
    <div class="form-row node-input-useAuth-row">
        <label for="node-input-appkey"><i class="fa fa-lock"></i> <span>Application Key</span></label>
        <input type="password" id="node-input-appkey">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div> 
    <div class="form-tips" id="node-tip"><span data-i18n="[html]thingrest.tip.cred"></span></div>   
</script>

<script type="text/x-red" data-help-name="REST Thing">
    <p>Provides a node updating a Thing on ThingWorx Server using the HTTP REST protocol..</p>
    <p>The properties that you want to update should appear in <code>msg.payload</code> as a JSON object.</p>
    <p>For example <code>msg.payload={stringProperty:"Hello World",numberProperty:123};</code></p>
    <ul>
        <li><code>url</code>, if set, is used as the url of the request. Must start with http: or https:</li>
        <li><code>Thing Name</code>, The name of the Thing on the server you want to update</li>
        <li><code>Application Key</code>, Obtained from your ThingWorx server, the application key authenticates your node with your ThingWorx server.</li>
    </ul>
    <p><b>Note</b>: If you need to configure a proxy please add <b>http_proxy=...</b> to your environment variables and restart Node-RED.</p>
</script>

<script type="text/javascript">

    RED.nodes.registerType('REST Thing',{
        category: 'output',
        color:"rgb(94, 186, 71)",
        defaults: {
            name: {value:""},
            url:{value:"http://localhost:8080"},
            thingname:{value:""}
            //user -> credentials
            //pass -> credentials
        },
        credentials: {
            appkey: {type:"password"}//,
            // user: {type:"text"},
            // password: {type: "password"}
        },
        inputs:1,
        outputs:0,
        icon: "thingworx.png",
        label: function() {
            return this.name||"Rest Thing";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            // if (this.credentials.user || this.credentials.has_password) {
            //     $('#node-input-useAuth').prop('checked', true);
            //     $(".node-input-useAuth-row").show();
            // } else {
            //     $('#node-input-useAuth').prop('checked', false);
            //     $(".node-input-useAuth-row").hide();
            // }

            // $("#node-input-useAuth").change(function() {
            //     if ($(this).is(":checked")) {
            //         $(".node-input-useAuth-row").show();
            //     } else {
            //         $(".node-input-useAuth-row").hide();
            //         $('#node-input-user').val('');
            //         $('#node-input-password').val('');
            //     }
            // });

            // $("#node-input-ret").change(function() {
            //     if ($("#node-input-ret").val() === "obj") {
            //         $("#tip-json").show();
            //     } else {
            //         $("#tip-json").hide();
            //     }
            // });
        }
    });
</script>
